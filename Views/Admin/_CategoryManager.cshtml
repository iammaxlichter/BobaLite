@model List<BobaLite.Models.Category>

@* 
    Admin Categories Management View
    Allows the admin to add parent and child categories,
    and manage (delete) existing categories in a table format.
*@

<section class="admin-categories">
    <!-- Form for adding a new parent category -->
    <form method="post" action="/Admin/AddParentCategory" class="form-row">
        <input type="text" name="name" placeholder="New parent category name" required />
        <button type="submit" class="add-btn">Add Parent Category</button>
    </form>

    <!-- Form for adding a new child category -->
    <form method="post" action="/Admin/AddChildCategory" class="form-row">
        <select name="parentId" required>
            <option disabled selected>Select parent category</option>
            @foreach (var parent in Model.Where(c => c.ParentCategoryId == null))
            {
                <option value="@parent.Id">@parent.Name</option>
            }
        </select>
        <input type="text" name="name" placeholder="New child category name" required />
        <button type="submit" class="add-btn">Add Child Category</button>
    </form>

    <!-- Table listing parent categories and their children with delete options -->
    <table class="admin-table">
        <thead>
            <tr>
                <th>Parent</th>
                <th>Children</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var parent in Model.Where(c => c.ParentCategoryId == null))
            {
                <tr>
                    <td>
                        <div class="category-header">
                            <strong>@parent.Name</strong>
                            <form method="post" action="/Admin/DeleteCategory" style="display:inline;"
                                onsubmit="return confirm('Delete this parent category and all its children?');">
                                <input type="hidden" name="categoryId" value="@parent.Id" />
                                <button type="submit" class="delete-btn">Delete</button>
                            </form>
                        </div>
                    </td>
                    <td>
                        <div class="category-children">
                            @if (!Model.Any(c => c.ParentCategoryId == parent.Id))
                            {
                                <span class="text-muted">None</span>
                            }
                            else
                            {
                                <ul>
                                    @foreach (var child in Model.Where(c => c.ParentCategoryId == parent.Id))
                                    {
                                        <li>
                                            @child.Name
                                            <form method="post" action="/Admin/DeleteCategory" style="display:inline;"
                                                onsubmit="return confirm('Delete this child category?');">
                                                <input type="hidden" name="categoryId" value="@child.Id" />
                                                <button type="submit" class="delete-btn2">Delete</button>
                                            </form>
                                        </li>
                                    }
                                </ul>
                            }
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</section>
